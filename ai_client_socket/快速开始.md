# 🚀 快速开始指南

这是一个针对RV1106B眼镜设备上AI客户端recv断开问题的调试环境。

## 📋 前提条件

- 安装了交叉编译工具链（`arm-linux-gnueabihf-gcc`）
- Python 3.x 环境
- 网络连接

## ⚡ 5分钟快速开始

### 1️⃣ 编译客户端
```bash
cd project/test/ai_client_socket
arm-linux-gnueabihf-gcc -o simple_client simple_client.c -lpthread -lrt -Wall -O2
```

### 2️⃣ 启动调试环境
```bash
# 方法1：使用自动化脚本（推荐）
chmod +x test_debug.sh
./test_debug.sh

# 方法2：手动启动
# 终端1：启动服务器
python3 mock_server.py --host 0.0.0.0 --port 8082

# 终端2：启动客户端
./simple_client 127.0.0.1 8082
```

### 3️⃣ 测试通信
在服务器控制台输入：
- `start` - 发送开始录音指令
- `stop` - 发送结束录音指令
- `quit` - 退出服务器

## 📁 文件说明

| 文件名 | 说明 |
|--------|------|
| `simple_client.c` | 简化版客户端源码 |
| `simple_client` | 编译后的ARM可执行文件 |
| `mock_server.py` | 模拟AI服务器 |
| `test_debug.sh` | 自动化测试脚本 |
| `compile.sh` | 完整版编译脚本（需要RK库） |
| `问题分析报告.md` | 详细的问题分析 |
| `部署运行说明.md` | 完整的部署文档 |

## 🎯 预期输出

### 客户端输出示例：
```
=== 简化版AI客户端 - recv断开调试版本 ===
服务器地址: 127.0.0.1:8082
========================================
正在连接到服务器 127.0.0.1:8082
✅ 成功连接到服务器 127.0.0.1:8082
📤 发送消息: 类型=0x0D, 数据长度=25
✅ 消息发送成功
[10:30:15.123] [CLIENT] 发送配置消息
[10:30:15.125] [CLIENT] GPIO监控线程启动
[10:30:15.126] [CLIENT] 等待GPIO按下 (等待'开始录音'指令)...
[10:30:15.127] [CLIENT] 开始等待socket数据...
```

### 服务器输出示例：
```
[10:30:15.124] [SERVER] 🚀 模拟AI服务器启动成功
[10:30:15.124] [SERVER] 📡 监听地址: 0.0.0.0:8082
[10:30:15.125] [SERVER] 🔗 新客户端连接: ('127.0.0.1', 45678)
[10:30:15.126] [SERVER] 📥 接收消息头: 类型=0x0D, 长度=25
[10:30:15.127] [SERVER] 🔧 接收到配置: {"response_format": "json"}

> start
[10:30:20.000] [SERVER] 🎤 发送开始录音指令...
[10:30:20.001] [SERVER] 📤 发送消息头: 类型=0x04, 长度=12
```

## 🔧 故障排查

### 编译失败
```bash
# 检查工具链
which arm-linux-gnueabihf-gcc

# 如果没有安装
sudo apt-get install gcc-arm-linux-gnueabihf
```

### 连接失败
```bash
# 检查端口占用
netstat -tulpn | grep 8082

# 检查防火墙
sudo ufw status
```

### 设备部署
```bash
# 传输到设备
scp simple_client root@<设备IP>:/tmp/
scp mock_server.py root@<设备IP>:/tmp/

# 在设备上运行
ssh root@<设备IP>
cd /tmp
./simple_client <服务器IP> 8082
```

## 📱 在眼镜设备上测试

1. **编译ARM版本**（已完成）
2. **传输到设备**：
   ```bash
   scp simple_client root@<眼镜设备IP>:/tmp/
   ```
3. **在设备上运行**：
   ```bash
   ssh root@<眼镜设备IP>
   cd /tmp
   ./simple_client <服务器IP> 8082
   ```

## 🐛 调试技巧

### 查看详细日志
程序会输出详细的时间戳日志，包括：
- 连接状态
- 消息收发
- 错误信息
- 性能统计

### 网络抓包
```bash
# 在服务器端
sudo tcpdump -i any -w capture.pcap port 8082

# 分析抓包文件
wireshark capture.pcap
```

### 性能监控
```bash
# 监控连接状态
watch -n 1 'netstat -an | grep 8082'

# 监控进程状态
top -p $(pgrep simple_client)
```

## 📞 支持

如果遇到问题：

1. 查看 `问题分析报告.md` 了解详细分析
2. 查看 `部署运行说明.md` 了解完整部署步骤
3. 检查日志输出定位问题
4. 使用网络工具验证连接

## 🎉 成功标志

当你看到以下输出时，说明环境配置成功：

✅ 客户端成功连接到服务器  
✅ 配置消息发送成功  
✅ GPIO监控线程启动  
✅ 能够接收服务器指令  
✅ 能够发送模拟录音数据  

恭喜！你现在可以开始调试recv断开问题了！🎊 